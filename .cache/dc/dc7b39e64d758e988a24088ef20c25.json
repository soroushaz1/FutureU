{"id":"node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBRDFFunctions.js","dependencies":[{"name":"F:\\FutureU\\babylonjs\\node_modules\\@babylonjs\\core\\Shaders\\ShadersInclude\\pbrBRDFFunctions.js.map","includedInParent":true,"mtime":1704105649768},{"name":"F:\\FutureU\\babylonjs\\package.json","includedInParent":true,"mtime":1704105536080},{"name":"F:\\FutureU\\babylonjs\\node_modules\\@babylonjs\\core\\package.json","includedInParent":true,"mtime":1704105648327},{"name":"../../Engines/shaderStore.js","loc":{"line":2,"column":28,"index":44},"parent":"F:\\FutureU\\babylonjs\\node_modules\\@babylonjs\\core\\Shaders\\ShadersInclude\\pbrBRDFFunctions.js","resolved":"F:\\FutureU\\babylonjs\\node_modules\\@babylonjs\\core\\Engines\\shaderStore.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.pbrBRDFFunctions = void 0;\nvar _shaderStore = require(\"../../Engines/shaderStore.js\");\n// Do not edit.\n\nconst name = \"pbrBRDFFunctions\";\nconst shader = `#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\nvec2 UV=vec2(NdotV,perceptualRoughness);\nvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{\nfloat c=1.0-NdotV;\nfloat c3=c*c*c;\nreturn 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));\n}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);\nvec3 getIORTfromAirToSurfaceR0(vec3 f0) {\nvec3 sqrtF0=sqrt(f0);\nreturn (1.+sqrtF0)/(1.-sqrtF0);\n}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {\nreturn square((iorT-vec3(iorI))/(iorT+vec3(iorI)));\n}\nfloat getR0fromIORs(float iorT,float iorI) {\nreturn square((iorT-iorI)/(iorT+iorI));\n}\nvec3 evalSensitivity(float opd,vec3 shift) {\nfloat phase=2.0*PI*opd*1.0e-9;\nconst vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);\nconst vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);\nconst vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);\nvec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);\nxyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));\nxyz/=1.0685e-7;\nvec3 srgb=XYZ_TO_REC709*xyz;\nreturn srgb;\n}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {\nvec3 I=vec3(1.0);\nfloat iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));\nfloat sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));\nfloat cosTheta2Sq=1.0-sinTheta2Sq;\nif (cosTheta2Sq<0.0) {\nreturn I;\n}\nfloat cosTheta2=sqrt(cosTheta2Sq);\nfloat R0=getR0fromIORs(iridescenceIOR,outsideIOR);\nfloat R12=fresnelSchlickGGX(cosTheta1,R0,1.);\nfloat R21=R12;\nfloat T121=1.0-R12;\nfloat phi12=0.0;\nif (iridescenceIOR<outsideIOR) phi12=PI;\nfloat phi21=PI-phi12;\nvec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);\nvec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));\nvec3 phi23=vec3(0.0);\nif (baseIOR[0]<iridescenceIOR) phi23[0]=PI;\nif (baseIOR[1]<iridescenceIOR) phi23[1]=PI;\nif (baseIOR[2]<iridescenceIOR) phi23[2]=PI;\nfloat opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;\nvec3 phi=vec3(phi21)+phi23;\nvec3 R123=clamp(R12*R23,1e-5,0.9999);\nvec3 r123=sqrt(R123);\nvec3 Rs=square(T121)*R23/(vec3(1.0)-R123);\nvec3 C0=R12+Rs;\nI=C0;\nvec3 Cm=Rs-T121;\nfor (int m=1; m<=2; ++m)\n{\nCm*=r123;\nvec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);\nI+=Cm*Sm;\n}\nreturn max(I,vec3(0.0));\n}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\nreturn 0.25/(VdotH*VdotH); \n}\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{\nfloat oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);\nfloat a=mix(21.5473,25.3245,oneMinusAlphaSq);\nfloat b=mix(3.82987,3.32435,oneMinusAlphaSq);\nfloat c=mix(0.19823,0.16801,oneMinusAlphaSq);\nfloat d=mix(-1.97760,-1.27393,oneMinusAlphaSq);\nfloat e=mix(-4.32054,-4.85967,oneMinusAlphaSq);\nreturn a/(1.0+b*pow(x,c))+d*x+e;\n}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{\nreturn abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));\n}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{\nfloat G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));\nreturn G/(4.0*NdotV*NdotL);\n}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n`;\n// Sideeffect\n_shaderStore.ShaderStore.IncludesShadersStore[name] = shader;\n/** @internal */\nconst pbrBRDFFunctions = exports.pbrBRDFFunctions = {\n  name,\n  shader\n};"},"sourceMaps":{"js":{"mappings":[{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":4}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":16}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":19}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":26}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":10,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":4,"column":6},"generated":{"line":10,"column":6}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":4,"column":10},"generated":{"line":10,"column":10}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":4,"column":13},"generated":{"line":10,"column":13}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":4,"column":31},"generated":{"line":10,"column":31}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":11,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":5,"column":6},"generated":{"line":11,"column":6}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":5,"column":12},"generated":{"line":11,"column":12}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":5,"column":15},"generated":{"line":11,"column":15}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":270,"column":1},"generated":{"line":276,"column":1}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":271,"column":0},"generated":{"line":277,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":0},"generated":{"line":278,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":11},"generated":{"line":278,"column":24}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":12},"generated":{"line":278,"column":25}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":32},"generated":{"line":278,"column":45}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":33},"generated":{"line":278,"column":46}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":37},"generated":{"line":278,"column":50}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":38},"generated":{"line":278,"column":51}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":41},"generated":{"line":278,"column":54}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":272,"column":47},"generated":{"line":278,"column":60}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":273,"column":0},"generated":{"line":279,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":7},"generated":{"line":280,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":13},"generated":{"line":280,"column":6}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":29},"generated":{"line":280,"column":22}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":29},"generated":{"line":280,"column":25}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":29},"generated":{"line":280,"column":32}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":29},"generated":{"line":280,"column":33}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":29},"generated":{"line":280,"column":49}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":32},"generated":{"line":280,"column":52}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":34},"generated":{"line":281,"column":2}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":38},"generated":{"line":281,"column":6}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":40},"generated":{"line":282,"column":2}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":46},"generated":{"line":283,"column":0}},{"source":"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts","name":null,"original":{"line":274,"column":48},"generated":{"line":283,"column":1}}],"sources":{"../../../../../lts/core/generated/Shaders/ShadersInclude/pbrBRDFFunctions.ts":"// Do not edit.\nimport { ShaderStore } from \"../../Engines/shaderStore\";\n\nconst name = \"pbrBRDFFunctions\";\nconst shader = `#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\rreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\r}\r#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\rvec2 UV=vec2(NdotV,perceptualRoughness);\rvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\r#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\r#endif\nreturn brdfLookup.rgb;\r}\rvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\r#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\r#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\r#endif\nreturn reflectance;\r}\rvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\r#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\r#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\r#endif\nreturn reflectance;\r}\r#endif\n/* NOT USED\r#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\r{\rfloat c=1.0-NdotV;\rfloat c3=c*c*c;\rreturn 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));\r}\r#endif\n*/\r#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\r{\rfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\rreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\r}\r#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\r* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\r* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\r*/\rvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\rvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\rreturn sheenEnvironmentReflectance;\r}\r#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\r{\rreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\r}\rfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\r{\rreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\r}\r#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\r#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\r#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\r#endif\n#else\nvec3 s=sqrt(f0);\rvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\rreturn square(t);\r#endif\n}\r#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\r3.2404542,-0.9692660, 0.0556434,\r-1.5371385, 1.8760108,-0.2040259,\r-0.4985314, 0.0415560, 1.0572252\r);\rvec3 getIORTfromAirToSurfaceR0(vec3 f0) {\rvec3 sqrtF0=sqrt(f0);\rreturn (1.+sqrtF0)/(1.-sqrtF0);\r}\rvec3 getR0fromIORs(vec3 iorT,float iorI) {\rreturn square((iorT-vec3(iorI))/(iorT+vec3(iorI)));\r}\rfloat getR0fromIORs(float iorT,float iorI) {\rreturn square((iorT-iorI)/(iorT+iorI));\r}\rvec3 evalSensitivity(float opd,vec3 shift) {\rfloat phase=2.0*PI*opd*1.0e-9;\rconst vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);\rconst vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);\rconst vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);\rvec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);\rxyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));\rxyz/=1.0685e-7;\rvec3 srgb=XYZ_TO_REC709*xyz;\rreturn srgb;\r}\rvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {\rvec3 I=vec3(1.0);\rfloat iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));\rfloat sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));\rfloat cosTheta2Sq=1.0-sinTheta2Sq;\rif (cosTheta2Sq<0.0) {\rreturn I;\r}\rfloat cosTheta2=sqrt(cosTheta2Sq);\rfloat R0=getR0fromIORs(iridescenceIOR,outsideIOR);\rfloat R12=fresnelSchlickGGX(cosTheta1,R0,1.);\rfloat R21=R12;\rfloat T121=1.0-R12;\rfloat phi12=0.0;\rif (iridescenceIOR<outsideIOR) phi12=PI;\rfloat phi21=PI-phi12;\rvec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \rvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);\rvec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));\rvec3 phi23=vec3(0.0);\rif (baseIOR[0]<iridescenceIOR) phi23[0]=PI;\rif (baseIOR[1]<iridescenceIOR) phi23[1]=PI;\rif (baseIOR[2]<iridescenceIOR) phi23[2]=PI;\rfloat opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;\rvec3 phi=vec3(phi21)+phi23;\rvec3 R123=clamp(R12*R23,1e-5,0.9999);\rvec3 r123=sqrt(R123);\rvec3 Rs=square(T121)*R23/(vec3(1.0)-R123);\rvec3 C0=R12+Rs;\rI=C0;\rvec3 Cm=Rs-T121;\rfor (int m=1; m<=2; ++m)\r{\rCm*=r123;\rvec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);\rI+=Cm*Sm;\r}\rreturn max(I,vec3(0.0));\r}\r#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\r{\rfloat a2=square(alphaG);\rfloat d=NdotH*NdotH*(a2-1.0)+1.0;\rreturn a2/(PI*d*d);\r}\r#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\r{\rfloat invR=1./alphaG;\rfloat cos2h=NdotH*NdotH;\rfloat sin2h=1.-cos2h;\rreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\r}\r#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\rfloat a2=alphaTB.x*alphaTB.y;\rvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);\rfloat v2=dot(v,v);\rfloat w2=a2/v2;\rreturn a2*w2*w2*RECIPROCAL_PI;\r}\r#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\r#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\rfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\rreturn 0.5/(GGXV+GGXL);\r#else\nfloat a2=alphaG*alphaG;\rfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\rfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\rreturn 0.5/(GGXV+GGXL);\r#endif\n}\r#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\r{\r#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\r#else\nfloat alphaSquared=alphaG*alphaG;\rreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\r#endif\n}\rfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\r{\rfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\rreturn visibility;\r}\r#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\rfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\rfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\rfloat v=0.5/(lambdaV+lambdaL);\rreturn v;\r}\r#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\rreturn 0.25/(VdotH*VdotH); \r}\r#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\r{\rreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\r}\r/* NOT USED\r#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\r{\rfloat oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);\rfloat a=mix(21.5473,25.3245,oneMinusAlphaSq);\rfloat b=mix(3.82987,3.32435,oneMinusAlphaSq);\rfloat c=mix(0.19823,0.16801,oneMinusAlphaSq);\rfloat d=mix(-1.97760,-1.27393,oneMinusAlphaSq);\rfloat e=mix(-4.32054,-4.85967,oneMinusAlphaSq);\rreturn a/(1.0+b*pow(x,c))+d*x+e;\r}\rfloat lambdaSheen(float cosTheta,float alphaG)\r{\rreturn abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));\r}\rfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\r{\rfloat G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));\rreturn G/(4.0*NdotV*NdotL);\r}\r#endif\n*/\r#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\rfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\rfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\rfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\rfloat fresnel =\r(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\r(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\rreturn fresnel/PI;\r}\r#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\rvec3 S=1./maxEps(diffusionDistance);\rvec3 temp=exp((-0.333333333*thickness)*S);\rreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\r}\rfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\rfloat t=1.0+w;\rfloat invt2=1.0/square(t);\rreturn saturate((NdotL+w)*invt2);\r}\r#endif\n`;\n// Sideeffect\nShaderStore.IncludesShadersStore[name] = shader;\n/** @internal */\nexport const pbrBRDFFunctions = { name, shader };\n"},"lineCount":null}},"error":null,"hash":"590f0e598346ec9ac238273d03f9603b","cacheData":{"env":{}}}