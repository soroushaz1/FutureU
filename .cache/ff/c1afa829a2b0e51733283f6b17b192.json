{"id":"node_modules/@babylonjs/core/Shaders/spriteMap.fragment.js","dependencies":[{"name":"F:\\FutureU\\babylonjs\\node_modules\\@babylonjs\\core\\Shaders\\spriteMap.fragment.js.map","includedInParent":true,"mtime":1704105649958},{"name":"F:\\FutureU\\babylonjs\\package.json","includedInParent":true,"mtime":1704105536080},{"name":"F:\\FutureU\\babylonjs\\node_modules\\@babylonjs\\core\\package.json","includedInParent":true,"mtime":1704105648327},{"name":"../Engines/shaderStore.js","loc":{"line":2,"column":28,"index":44},"parent":"F:\\FutureU\\babylonjs\\node_modules\\@babylonjs\\core\\Shaders\\spriteMap.fragment.js","resolved":"F:\\FutureU\\babylonjs\\node_modules\\@babylonjs\\core\\Engines\\shaderStore.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.spriteMapPixelShader = void 0;\nvar _shaderStore = require(\"../Engines/shaderStore.js\");\n// Do not edit.\n\nconst name = \"spriteMapPixelShader\";\nconst shader = `#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)\n#else\n#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)\n#endif\nprecision highp float;\nvarying vec3 vPosition;\nvarying vec2 vUV;\nvarying vec2 tUV;\nuniform float time;\nuniform float spriteCount;\nuniform sampler2D spriteSheet;\nuniform vec2 spriteMapSize;\nuniform vec2 outputSize;\nuniform vec2 stageSize;\nuniform sampler2D frameMap;\nuniform sampler2D tileMaps[LAYERS];\nuniform sampler2D animationMap;\nuniform vec3 colorMul;\nfloat mt;\nconst float fdStep=1./4.;\nconst float aFrameSteps=1./MAX_ANIMATION_FRAMES;\nmat4 getFrameData(float frameID){\nfloat fX=frameID/spriteCount;\nreturn mat4(\ntexture2D(frameMap,vec2(fX,0.),0.),\ntexture2D(frameMap,vec2(fX,fdStep*1.),0.),\ntexture2D(frameMap,vec2(fX,fdStep*2.),0.),\nvec4(0.)\n);\n}\nvoid main(){\nvec4 color=vec4(0.);\nvec2 tileUV=fract(tUV);\n#ifdef FLIPU\ntileUV.y=1.0-tileUV.y;\n#endif\nvec2 tileID=floor(tUV);\nvec2 sheetUnits=1./spriteMapSize;\nfloat spriteUnits=1./spriteCount;\nvec2 stageUnits=1./stageSize;\nfor(int i=0; i<LAYERS; i++) {\nfloat frameID;\n#define LAYER_ID_SWITCH\nvec4 animationData=TEXTUREFUNC(animationMap,vec2((frameID+0.5)/spriteCount,0.),0.);\nif(animationData.y>0.) {\nmt=mod(time*animationData.z,1.0);\nfor(float f=0.; f<MAX_ANIMATION_FRAMES; f++){\nif(animationData.y>mt){\nframeID=animationData.x;\nbreak;\n}\nanimationData=TEXTUREFUNC(animationMap,vec2((frameID+0.5)/spriteCount,aFrameSteps*f),0.);\n}\n}\nmat4 frameData=getFrameData(frameID+0.5);\nvec2 frameSize=(frameData[0].zw)/spriteMapSize;\nvec2 offset=frameData[0].xy*sheetUnits;\nvec2 ratio=frameData[2].xy/frameData[0].zw;\nif (frameData[2].z==1.){\ntileUV.xy=tileUV.yx;\n}\nvec4 nc=texture2D(spriteSheet,tileUV*frameSize+offset);\nif (i==0){\ncolor=nc;\n} else {\nfloat alpha=min(color.a+nc.a,1.0);\nvec3 mixed=mix(color.xyz,nc.xyz,nc.a);\ncolor=vec4(mixed,alpha);\n}\n}\ncolor.xyz*=colorMul;\ngl_FragColor=color;\n}`;\n// Sideeffect\n_shaderStore.ShaderStore.ShadersStore[name] = shader;\n/** @internal */\nconst spriteMapPixelShader = exports.spriteMapPixelShader = {\n  name,\n  shader\n};"},"sourceMaps":{"js":{"mappings":[{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":4}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":16}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":19}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":7,"column":26}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":10,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":4,"column":6},"generated":{"line":10,"column":6}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":4,"column":10},"generated":{"line":10,"column":10}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":4,"column":13},"generated":{"line":10,"column":13}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":4,"column":35},"generated":{"line":10,"column":35}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":11,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":5,"column":6},"generated":{"line":11,"column":6}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":5,"column":12},"generated":{"line":11,"column":12}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":5,"column":15},"generated":{"line":11,"column":15}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":78,"column":2},"generated":{"line":84,"column":2}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":79,"column":0},"generated":{"line":85,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":0},"generated":{"line":86,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":11},"generated":{"line":86,"column":24}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":12},"generated":{"line":86,"column":25}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":24},"generated":{"line":86,"column":37}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":25},"generated":{"line":86,"column":38}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":29},"generated":{"line":86,"column":42}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":30},"generated":{"line":86,"column":43}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":33},"generated":{"line":86,"column":46}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":80,"column":39},"generated":{"line":86,"column":52}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":81,"column":0},"generated":{"line":87,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":7},"generated":{"line":88,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":13},"generated":{"line":88,"column":6}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":33},"generated":{"line":88,"column":26}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":33},"generated":{"line":88,"column":29}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":33},"generated":{"line":88,"column":36}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":33},"generated":{"line":88,"column":37}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":33},"generated":{"line":88,"column":57}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":36},"generated":{"line":88,"column":60}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":38},"generated":{"line":89,"column":2}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":42},"generated":{"line":89,"column":6}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":44},"generated":{"line":90,"column":2}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":50},"generated":{"line":91,"column":0}},{"source":"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts","name":null,"original":{"line":82,"column":52},"generated":{"line":91,"column":1}}],"sources":{"../../../../lts/core/generated/Shaders/spriteMap.fragment.ts":"// Do not edit.\nimport { ShaderStore } from \"../Engines/shaderStore\";\n\nconst name = \"spriteMapPixelShader\";\nconst shader = `#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)\n#else\n#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)\n#endif\nprecision highp float;\rvarying vec3 vPosition;\rvarying vec2 vUV;\rvarying vec2 tUV;\runiform float time;\runiform float spriteCount;\runiform sampler2D spriteSheet;\runiform vec2 spriteMapSize;\runiform vec2 outputSize;\runiform vec2 stageSize;\runiform sampler2D frameMap;\runiform sampler2D tileMaps[LAYERS];\runiform sampler2D animationMap;\runiform vec3 colorMul;\rfloat mt;\rconst float fdStep=1./4.;\rconst float aFrameSteps=1./MAX_ANIMATION_FRAMES;\rmat4 getFrameData(float frameID){\rfloat fX=frameID/spriteCount;\rreturn mat4(\rtexture2D(frameMap,vec2(fX,0.),0.),\rtexture2D(frameMap,vec2(fX,fdStep*1.),0.),\rtexture2D(frameMap,vec2(fX,fdStep*2.),0.),\rvec4(0.)\r);\r}\rvoid main(){\rvec4 color=vec4(0.);\rvec2 tileUV=fract(tUV);\r#ifdef FLIPU\ntileUV.y=1.0-tileUV.y;\r#endif\nvec2 tileID=floor(tUV);\rvec2 sheetUnits=1./spriteMapSize;\rfloat spriteUnits=1./spriteCount;\rvec2 stageUnits=1./stageSize;\rfor(int i=0; i<LAYERS; i++) {\rfloat frameID;\r#define LAYER_ID_SWITCH\nvec4 animationData=TEXTUREFUNC(animationMap,vec2((frameID+0.5)/spriteCount,0.),0.);\rif(animationData.y>0.) {\rmt=mod(time*animationData.z,1.0);\rfor(float f=0.; f<MAX_ANIMATION_FRAMES; f++){\rif(animationData.y>mt){\rframeID=animationData.x;\rbreak;\r}\ranimationData=TEXTUREFUNC(animationMap,vec2((frameID+0.5)/spriteCount,aFrameSteps*f),0.);\r}\r}\rmat4 frameData=getFrameData(frameID+0.5);\rvec2 frameSize=(frameData[0].zw)/spriteMapSize;\rvec2 offset=frameData[0].xy*sheetUnits;\rvec2 ratio=frameData[2].xy/frameData[0].zw;\rif (frameData[2].z==1.){\rtileUV.xy=tileUV.yx;\r}\rvec4 nc=texture2D(spriteSheet,tileUV*frameSize+offset);\rif (i==0){\rcolor=nc;\r} else {\rfloat alpha=min(color.a+nc.a,1.0);\rvec3 mixed=mix(color.xyz,nc.xyz,nc.a);\rcolor=vec4(mixed,alpha);\r}\r}\rcolor.xyz*=colorMul;\rgl_FragColor=color;\r}`;\n// Sideeffect\nShaderStore.ShadersStore[name] = shader;\n/** @internal */\nexport const spriteMapPixelShader = { name, shader };\n"},"lineCount":null}},"error":null,"hash":"feee9abfabd705f73346a4bcc3de0064","cacheData":{"env":{}}}